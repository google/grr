<div *ngIf="flowError$ | async; else noError" class="error">
  An error was encountered.
  <div *ngIf="resultsStderr$ | async as resultsStderr">
    stderr is: {{resultsStderr}}
  </div>
</div>

<ng-template #noError>
  <div *ngIf="flowRunning$ | async; else showResults" class="in-progress">
    Query in progress: {{ (args$ | async).query }}
  </div>

  <ng-template #showResults>
    <div *ngIf="resultsTable$ | async as resultsTable; else noResultsTable" class="results-table">
      <osquery-results-table
        [table]="resultsTable">
      </osquery-results-table>
    </div>

    <ng-template #noResultsTable>
      <div *ngIf="progressTable$ | async as progressTable; else noTables" class="progress-table">
        <osquery-results-table
          [table]="progressTable">
        </osquery-results-table>

        <ng-container *ngIf="(additionalRowsAvailable$ | async) !== 0">
          <div
          *ngIf="additionalRowsAvailable$ | async as additionalCount; else progressCountUndefined"
          class="show-additional">
            <button (click)="loadCompleteResults()">View all rows ({{additionalCount}} more)</button>
          </div>
        </ng-container>
      </div>
    </ng-template>

    <ng-template #noTables #progressCountUndefined>
      <div class="error-show-additional">
        <span>Results might be missing or incomplete.</span>
        <button (click)="loadCompleteResults()">Try requesting the full table</button>
      </div>
    </ng-template>
  </ng-template>
</ng-template>
